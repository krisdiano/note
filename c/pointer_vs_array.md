# 指针和数组

指针是很多人学习C时最看不懂的知识点，其实我觉得只要是认真学习的，了解程序设计的，都知道指针是什么，以及指针为什么可以间接访问，只不过在写的过程中会出现野指针，真正不懂的人那就是真的没有好好学习了。

在C中，数组经常和指针混在一起，两者也有一定的关联，但是毕竟两者不是一种类型，还是要分开看待的，正确的认识什么是指针什么是数组是很重要的。

指针，也是一个变量，这种类型存在的意义是为了实现间接访问与之关联的那块内存。变量是内存的别名，要访问一块内存，可以通过变量名直接访问，其次就是通过指针间接访问。（变量直接将它对应的内存中的数据作为变量的值，不同的是指针变量的值是一个地址，可以再次寻址）那么什么时候需要使用指针呢？一是函数内部想要改变实参的值，二是拷贝传递复杂类型时。

数组是相同类型的变量的有序集合，在内存中是一片连续的内存空间。数组名中不包含数组的长度信息，可以看做是一个指向数组首元素的常量指针。`&array_name`得到的是指向当前数组的指针，虽然两者的值是一样的，但却是两个完全不同的概念，需要区分开来。

回到之前没有结束的话题，为什么数组名只是能看做是一个指向数组首元素的常量指针，因为大多数情况下都符合指针的行为，但是有两种情况却与指针的行为不同：

- 参与`sizeof`运算时
- 取地址时

指针和数组之间还有一个比较好玩的知识点，就是`[]`这个语法既可以在数组中使用，也可以在指针中使用，这是为什么呢？这是因为指针和整数是可以运算的，不过得到的值并不是指针中存储的地址简单的加上一个数获取减去一个数，而是和类型挂钩的，最终得到结果是一个指针，运算规则如下：

```c
p + n == (unsigned int)p + n * sizeof(*ptr) 
```

那么指针和整数的运算和`[]`有什么关系呢，关系如下：

```c
p[idx] == *(p+idx) == *(idx+p) == idx[p]
```

可以看出`[]`就是得到指针和整数运算后的指针指向的内存中的值。有可能你觉得`idx[p]`这是不可以的，其实是可以的，不信你找个编译器试一试。

指针和数组之间还有一点能扯上关系，那就是数组类型作为参数时，数组会退化为数组首元素的指针，这也是为什么数组作为参数时，还需要额外的提供一个长度信息。（如果是一个数组变量，可以根据指针减法得到数组的大小信息）

除了指针和整数的运算，指针之间也是可以运算的，支持指针间的减法，不过减法有意义的前提是参与运算的两个指针是同一种类型，并且指向同一个数组中的空间，否则结果就是未定义的，不过此时的结果肯定是无意义的。当减法运算有意义时，得到的结果是一个整数，运算规则如下：

```c
// 其实结果就是数组的两个下标之差
p1 - p2 == ((unsigned int)p1 - (unsigned int)p2) / sizeof(type)
```

当然了，指针之间也支持关系运算（`>`，`>=`，`<`，`<=`），关系运算有意义的前提和减法是一致的。

最后的最后指针还支持比较操作，没有什么限制，不过除了和`NULL`比较之外，比较的两者尽量是同种类型。（不同的类型比较有什么意义吗，如果有，并且不会导致产生`bug`，那么可以使用）

